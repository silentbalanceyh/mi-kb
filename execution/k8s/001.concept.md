# K8S基本概念

## 1. 资源对象

### 分类

&ensp;&ensp;&ensp;&ensp;K8S中主要对象为资源对象——**Resource Object**，分两大类：

1. 名词类：节点 Node、Pod、服务 Service、存储卷 Volume。
3. 相关事物和动作：标签 Label、注解 Annoation、名空间 Namespace、部署 Deployment、HPA、PVC

&ensp;&ensp;&ensp;&ensp;资源对象通用属性：`版本、类别（Kind）、名称、标签、注解`，结构参考下边片段：

```yaml
apiVersion: v1
kind: Service
metadata:
    name: xxx
    labels:
        first: xxx
```

> 名称、标签、注解同属metadata节点。

&ensp;&ensp;&ensp;&ensp;配置文件格式可使用JSON或YAML（后者居多），这些配置全部都保存在etcd中，您可使用kubectl工具对其进行各种操作。

### 特征

* 名称必须唯一。
* 标签很重要（K8S设计亮点）
    * 表明资源对象特征、类别。
    * 实现对象之间关联、控制、协作。
* 注解是特殊标签，和程序挂钩实现自定义扩展。

### 生命周期

> 部分资源对象带有生命周期如Pod

|状态|周期|
|---|:---|
|Pending|等待调度、调度完成过后。|
|Running|镜像下载、启动、启动成功过后。|
|Succeeded|正常停止后。|
|Failed|非正常停止后。|

## 2. 四大类

### 2.1. 集群类

&ensp;&ensp;&ensp;&ensp;集群Cluster由Master和Node两种节点组成。

**Master**

&ensp;&ensp;&ensp;&ensp;Master负责管理和控制，每个K8S集群中都需要有**一个**或**一组**（HA环境中最少3台服务器，Master占一台独立服务器）。


|进程|名称/责任|
|:---|---|
|kube-apiserver|Kubernates API Server|
||提供RESTful API的主服务，增删改唯一入口。|
|kube-controller-manager|Kubernates Controller Manager|
||所有资源对象自动化控制中心——总管。|
|kube-scheduler|Kubernates Scheduler|
||负责资源调度的进程。|

> 除此在Master上需部署etcd服务。

**Node**

> 旧版又称Minion。

&ensp;&ensp;&ensp;&ensp;工作负载节点，某个宕机会自动转移到另外一个。

|进程|名称/责任|
|:---|---|
|kubelet|Pod容器的创建、启停任务。|
|kube-proxy|实现K8S Service的通信和负载均衡。|
|运行时容器（Docker）|负责本机的容器创建以及管理。|

&ensp;&ensp;&ensp;&ensp;Node自检结果

|状态|含义|
|---|:---|
|Ready|健康就绪状态。|
|DiskPressure|磁盘空间不足。|
|MemoryPressure|内存不足。|
|NetworkUnavailable|网络异常。|
|PIDPressure|PID资源不足。|

```shell
# 查看
kubectl get nodes
# 详细信息
kubectl describe node <node_name>
```

**Namespace**

&ensp;&ensp;&ensp;&ensp;用于实现多租户隔离，每个租户分配一个命名空间。安装完成和运行后Master会创建两个默认名空间：

* default：默认的（用户资源对象）
* kube-system：系统级的（网络、DNS、监控类）

&ensp;&ensp;&ensp;&ensp;定义片段如下

```yaml
# 名空间定义
apiVersion: v1
kind: Namespace
metadata:
    name: development
# 名空间使用
apiVersion: v1
kind: Pod
metadata:
    name: busybox
    namespace: development
```

&ensp;&ensp;&ensp;&ensp;定义名空间过后执行命令会有所区别：

```shell
# 无法查询对应的Pod对象
kubectl get pods
# 必须加上名空间参数
kubectl get pods --namespace=development
```
